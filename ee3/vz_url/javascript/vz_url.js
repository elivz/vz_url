"use strict";!function(t,i){function e(t){var e=this;this.timer=!1,this.delay=500,this.regex=/^(https?|ftp):\/\/[^\s\/$.?#].[^\s]*$/i,this.$field=t,this.$wrapper=this.$field.parent(),this.$msg=this.$field.next(),this.actionUrl=i.vzUrlSettings.actionUrl,this.lang=i.vzUrlSettings.lang,this.$field.on("keyup paste",function(){e.checkField()}),this.checkField(!0)}e.prototype.checkField=function(i){this.timer&&clearTimeout(this.timer),""!==this.$field.val()&&(i?this.validate(this.$field):this.timer=setTimeout(t.proxy(this.validate,this),this.delay))},e.prototype.validate=function(){var i=this,e=this.$field.val();if(this.setStatus("checking"),"#"===e.charAt(0)||"?"===e.charAt(0))return void this.setStatus("valid");if(!e.match(this.regex))return void this.setStatus("invalid");var s=e.replace("http","ht^tp");t.getJSON(this.actionUrl+"&callback=?",{url:s}).done(function(t){t.original===i.$field.val()&&(t.http_code>=200&&t.http_code<400?t.original===t.final_url?i.setStatus("valid"):i.setStatus("redirect",t):i.setStatus("invalid"))}).fail(function(){i.setStatus("invalid")})},e.prototype.setStatus=function(i,e){var s=this;if(this.$field.prev().remove(),this.$wrapper.removeClass("empty checking invalid valid redirect"),this.$msg.empty(),"invalid"===i?(this.$msg.text(this.lang.errorText),this.$wrapper.addClass("invalid")):"redirect"===i&&(this.$field.hasClass("follow-redirects")?(this.$wrapper.addClass("warning"),this.$msg.text(this.lang.redirectText+" "+e.final_url+" "),t("<a/>",{text:this.lang.redirectUpdate,href:"","class":"btn action",click:function(t){s.$field.val(e.final_url),s.validate(s.$field),t.preventDefault()}}).appendTo(this.$msg)):i="valid"),this.$wrapper.addClass(i),"empty"!==i&&"checking"!==i){var a=t("<a/>",{href:this.$field.val(),"class":"vzurl-visit",target:"_blank",title:this.lang.openText+": "+this.$field.val()});this.$field.before(a)}},i.VzUrl=e,i.Grid.bind("vz_url","display",function(t){var i=t.find(".vzurl-field");new e(i)})}(window.jQuery,window);