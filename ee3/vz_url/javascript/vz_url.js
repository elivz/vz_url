"use strict";!function(t,i){function e(t){return encodeURI(t).replace(/%25/g,"%").replace(/%5B/g,"[").replace(/%5D/g,"]")}function a(t){var e=this;this.timer=!1,this.delay=500,this.regex=new RegExp("^((https?|ftp)://[\\w\\-_]+(\\.[\\w\\-_]+)+|/)([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%!&amp;/~\\+#])?$","gi"),this.$field=t,this.$wrapper=this.$field.parent(),this.$msg=this.$field.next(),this.actionUrl=i.vzUrlSettings.actionUrl,this.lang=i.vzUrlSettings.lang,this.$field.on("keyup paste",function(){e.checkField()}),this.checkField(!0)}a.prototype.checkField=function(i){this.timer&&clearTimeout(this.timer),""!==this.$field.val()&&(i?this.validate(this.$field):this.timer=setTimeout(t.proxy(this.validate,this),this.delay))},a.prototype.validate=function(){var i=this,a=e(this.$field.val());if(this.setStatus("checking"),"#"===a.charAt(0)||"?"===a.charAt(0))return void this.setStatus("valid");if(!a.match(this.regex))return void this.setStatus("invalid");var s=a.replace("http","ht^tp");t.getJSON(this.actionUrl+"&callback=?",{url:s}).done(function(t){t.original===e(i.$field.val())&&(t.http_code>=200&&t.http_code<400?t.original===t.final_url?i.setStatus("valid"):i.setStatus("redirect",t):i.setStatus("invalid"))}).fail(function(){i.setStatus("invalid")})},a.prototype.setStatus=function(i,e){var a=this;if(this.$field.prev().remove(),this.$wrapper.removeClass("empty checking invalid valid redirect"),this.$msg.empty(),"invalid"===i?(this.$msg.text(this.lang.errorText),this.$wrapper.addClass("invalid")):"redirect"===i&&(this.$field.hasClass("follow-redirects")?(this.$wrapper.addClass("warning"),this.$msg.text(this.lang.redirectText+" "+e.final_url+" "),t("<a/>",{text:this.lang.redirectUpdate,href:"","class":"btn action",click:function(t){a.$field.val(e.final_url),a.validate(a.$field),t.preventDefault()}}).appendTo(this.$msg)):i="valid"),this.$wrapper.addClass(i),"empty"!==i&&"checking"!==i){var s=t("<a/>",{href:this.$field.val(),"class":"vzurl-visit",target:"_blank",title:this.lang.openText+": "+this.$field.val()});this.$field.before(s)}},i.VzUrl=a,i.Grid.bind("vz_url","display",function(t){var i=t.find(".vzurl-field");new a(i)})}(window.jQuery,window);