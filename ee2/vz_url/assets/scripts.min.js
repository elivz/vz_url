var vzUrl={regex:new RegExp("^((https?|ftp)://[\\w\\-_]+(\\.[\\w\\-_]+)+|/)([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%!&amp;/~\\+#])?$","gi"),init:function(){$("#publishForm").on("keyup paste",".vz_url_field",function(a){vzUrl.check_field.call(a.target,!0)}),$(".vz_url_field").each(vzUrl.check_field),"undefined"!=typeof Grid&&Grid.bind("vz_url","display",function(a){vzUrl.check_field.call(a.find("input"))}),"undefined"!=typeof Matrix&&Matrix.bind("vz_url","display",function(){vzUrl.check_field.call(this.find("input"))})},check_field:function(a){return $field=$(this),a&&vzUrl.timer&&clearTimeout(vzUrl.timer),"http://"===$field.val()||""===$field.val()?(vzUrl.set_status($field,"empty"),void 0):(vzUrl.set_status($field,"checking"),a?vzUrl.timer=setTimeout(function(){vzUrl.validate($field)},500):vzUrl.validate($field),void 0)},validate:function(a){var b=vzUrl.encode_uri(a.val());if(!b.match(vzUrl.regex))return vzUrl.set_status(a,"invalid"),void 0;if(a.hasClass("local")&&"/"!=b.substr(0,1)&&-1==b.indexOf(document.domain))return vzUrl.set_status(a,"nonlocal"),void 0;var c=b.replace("http","");$.getJSON(window.location.href.split("?")[0]+"?callback=?",{caller:"vz_url",url:c},function(b){b.original==vzUrl.encode_uri(a.val())&&(b.original==b.final_url&&b.http_code>=200&&b.http_code<400?vzUrl.set_status(a,"valid"):b.original!=b.final_url?vzUrl.set_status(a,"redirect",b):vzUrl.set_status(a,"invalid"))})},set_status:function(a,b,c){a.removeClass("empty checking invalid valid nonlocal redirect"),a.prev().remove();var d=a.next().empty();switch(b){case"empty":case"checking":case"valid":break;case"invalid":d.html(vzUrl_settings.errorText);break;case"nonlocal":d.html(vzUrl_settings.nonlocalText);break;case"redirect":a.hasClass("show_redirect")?(d.html(vzUrl_settings.redirectText+" "+c.final_url),$("<a/>",{text:vzUrl_settings.redirectUpdate,href:"#","data-final_url":c.final_url,click:function(){return a.val($(this).attr("data-final_url")),vzUrl.validate(a),!1}}).appendTo(d)):a.removeClass("redirect").addClass("valid")}a.addClass(b),("valid"===b||"redirect"===b)&&a.before('<a href="'+a.val()+'" class="vz_url_visit" target="_blank">'+vzUrl_settings.openText+"</a>")},encode_uri:function(a){return encodeURI(a).replace(/%25/g,"%").replace(/%5B/g,"[").replace(/%5D/g,"]")}};vzUrl.init();